const std = @import("std");
const z2d = @import("z2d.zig");

pub fn main() !void {
    // Grabbed from stackoverflow here:
    // https://codegolf.stackexchange.com/a/16857
    const image =
        \\                             0000000000000000000000000                             
        \\                        00000000000000000000000000000000000                        
        \\                    0000000000000000000000000000000000000000000                    
        \\                 0000000000000000000000000000000000000000000000000                 
        \\               00000000000000000000000000000000000000000000000000000               
        \\             000000000000000000000000000000000000000000000000000000000             
        \\           0000000000000000000000000000000000000000000000000000000000000           
        \\         00000000000000000000000000000000000000000000000000000000000000000         
        \\        0000000000000000000000000000000000000000000000000000000000000000000        
        \\      00000000000000000000000000000000000000000000000000000000000000000000000      
        \\     0000000000000000000000000000000000000000000000000000000000000000000000000     
        \\    000000000000000000000000000000000000000000000000000000000000000000000000000    
        \\   0000000000000000   000000000000000000000000000000000000000   0000000000000000   
        \\  0000000000000000     0000000000000000000000000000000000000     0000000000000000  
        \\  000000000000000       00000000000000000000000000000000000       000000000000000  
        \\ 0000000000000000       00000000000000000000000000000000000       0000000000000000 
        \\ 0000000000000000       00000000000000000000000000000000000       0000000000000000 
        \\00000000000000000       00000000000000000000000000000000000       00000000000000000
        \\00000000000000000       00000000000000000000000000000000000       00000000000000000
        \\000000000000000000     0000000000000000000000000000000000000     000000000000000000
        \\00000000000000000000000000000000000000000000000000000000000000000000000000000000000
        \\00000000000000000000000000000000000000000000000000000000000000000000000000000000000
        \\00000000000000000000000000000000000000000000000000000000000000000000000000000000000
        \\00000000000000000000000000000000000000000000000000000000000000000000000000000000000
        \\ 000000000000000000000000000000000000000000000000000000000000000000000000000000000 
        \\ 0000000000000000                                                 0000000000000000 
        \\  000000000000000                                                 000000000000000  
        \\  0000000000000000                                               0000000000000000  
        \\   00000000000000000                                           00000000000000000   
        \\    00000000000000000                                         00000000000000000    
        \\     000000000000000000                                     000000000000000000     
        \\      0000000000000000000                                 0000000000000000000      
        \\        00000000000000000000                           00000000000000000000        
        \\         00000000000000000000000                   00000000000000000000000         
        \\           0000000000000000000000000000000000000000000000000000000000000           
        \\             000000000000000000000000000000000000000000000000000000000             
        \\               00000000000000000000000000000000000000000000000000000               
        \\                 0000000000000000000000000000000000000000000000000                 
        \\                    0000000000000000000000000000000000000000000                    
        \\                        00000000000000000000000000000000000                        
        \\                             0000000000000000000000000                             
    ;
    var gpa = std.heap.GeneralPurposeAllocator(.{}){};
    const alloc = gpa.allocator();
    var sfc = try z2d.ImageSurface(z2d.RGB).init(alloc, 41, 83);
    defer sfc.deinit();
    var x: u32 = 0;
    var y: u32 = 0;
    for (image[0..image.len]) |c| {
        if (c == '\n') {
            y += 1;
            x = 0;
            continue;
        }

        const pixel: z2d.RGB = if (c == '0')
            .{
                .r = 0,
                .g = 0,
                .b = 0,
            }
        else
            .{
                .r = 255,
                .g = 255,
                .b = 255,
            };
        try sfc.putPixel(x, y, pixel);
        x += 1;
    }
    try z2d.PNGExporter(z2d.RGB).writeToFile(alloc, sfc, "out.png");
    std.log.info("Test image has been written successfully to out.png.", .{});
}
